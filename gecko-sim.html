<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gecko Vision Simulation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .simulation-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .canvas-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        label {
            font-weight: bold;
        }
        .description {
            margin: 20px 0;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <h1>Gecko Vision Simulation</h1>
    
    <div class="simulation-container">
        <h2>Basic Gecko Vision</h2>
        <div class="description">
            <p>This simulation demonstrates how geckos might perceive the world differently from humans. 
               The left image shows a scene as humans would see it, while the right shows the same scene 
               as a gecko might perceive it, with enhanced blue-green sensitivity and improved night vision.</p>
        </div>
        
        <div class="controls">
            <button id="generateScene">Generate New Scene</button>
            <div class="slider-container">
                <label for="nightVision">Night Vision Strength:</label>
                <input type="range" id="nightVision" min="1" max="3" step="0.1" value="1.5">
                <span id="nightVisionValue">1.5</span>
            </div>
            <div class="slider-container">
                <label for="colorSensitivity">Color Sensitivity:</label>
                <input type="range" id="colorSensitivity" min="0.5" max="2" step="0.1" value="1.2">
                <span id="colorSensitivityValue">1.2</span>
            </div>
        </div>
        
        <div class="canvas-container">
            <div>
                <h3>Human Vision</h3>
                <canvas id="humanCanvas" width="500" height="500"></canvas>
            </div>
            <div>
                <h3>Gecko Vision</h3>
                <canvas id="geckoCanvas" width="500" height="500"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Get canvas elements and contexts
        const humanCanvas = document.getElementById('humanCanvas');
        const geckoCanvas = document.getElementById('geckoCanvas');
        const humanCtx = humanCanvas.getContext('2d');
        const geckoCtx = geckoCanvas.getContext('2d');
        
        // Get controls
        const generateButton = document.getElementById('generateScene');
        const nightVisionSlider = document.getElementById('nightVision');
        const nightVisionValue = document.getElementById('nightVisionValue');
        const colorSensitivitySlider = document.getElementById('colorSensitivity');
        const colorSensitivityValue = document.getElementById('colorSensitivityValue');
        
        // Scene parameters
        const width = humanCanvas.width;
        const height = humanCanvas.height;
        let scene = [];
        
        // Initialize scene data
        function initializeScene() {
            scene = [];
            for (let y = 0; y < height; y++) {
                const row = [];
                for (let x = 0; x < width; x++) {
                    // Dark background
                    row.push([0, 0, 0]);
                }
                scene.push(row);
            }
        }
        
        // Generate a random scene
        function generateScene() {
            initializeScene();
            
            // Add stars (random bright dots)
            for (let i = 0; i < 300; i++) {
                const x = Math.floor(Math.random() * width);
                const y = Math.floor(Math.random() * height);
                if (Math.random() > 0.7) {
                    scene[y][x] = [1, 1, 1]; // White star
                }
            }
            
            // Add a moon
            const moonX = Math.floor(Math.random() * (width - 100)) + 50;
            const moonY = Math.floor(Math.random() * (height - 100)) + 50;
            const moonRadius = Math.floor(Math.random() * 20) + 30;
            
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const distance = Math.sqrt((x - moonX) ** 2 + (y - moonY) ** 2);
                    if (distance < moonRadius) {
                        scene[y][x] = [0.8, 0.8, 0.8]; // Gray moon
                    }
                }
            }
            
            // Add insects (prey)
            for (let i = 0; i < 5; i++) {
                const insectX = Math.floor(Math.random() * (width - 60)) + 30;
                const insectY = Math.floor(Math.random() * (height - 60)) + 30;
                const insectRadius = Math.floor(Math.random() * 5) + 5;
                const insectType = Math.floor(Math.random() * 3);
                
                let insectColor;
                if (insectType === 0) {
                    insectColor = [0.1, 0.8, 0.1]; // Green insect
                } else if (insectType === 1) {
                    insectColor = [0.1, 0.1, 0.8]; // Blue insect
                } else {
                    insectColor = [0.8, 0.1, 0.1]; // Red insect
                }
                
                for (let y = 0; y < height; y++) {
                    for (let x = 0; x < width; x++) {
                        const distance = Math.sqrt((x - insectX) ** 2 + (y - insectY) ** 2);
                        if (distance < insectRadius) {
                            scene[y][x] = insectColor;
                        }
                    }
                }
            }
            
            // Add foliage (background elements)
            for (let i = 0; i < 10; i++) {
                const foliageX = Math.floor(Math.random() * (width - 80)) + 40;
                const foliageY = Math.floor(Math.random() * (height - 80)) + 40;
                const foliageRadius = Math.floor(Math.random() * 15) + 15;
                
                for (let y = 0; y < height; y++) {
                    for (let x = 0; x < width; x++) {
                        const distance = Math.sqrt((x - foliageX) ** 2 + (y - foliageY) ** 2);
                        if (distance < foliageRadius) {
                            scene[y][x] = [0.05, 0.2, 0.05]; // Dark green foliage
                        }
                    }
                }
            }
            
            renderScene();
        }
        
        // Render the scene to both canvases
        function renderScene() {
            // Clear canvases
            humanCtx.clearRect(0, 0, width, height);
            geckoCtx.clearRect(0, 0, width, height);
            
            // Create image data objects
            const humanImageData = humanCtx.createImageData(width, height);
            const geckoImageData = geckoCtx.createImageData(width, height);
            
            // Get night vision and color sensitivity values
            const nightVisionStrength = parseFloat(nightVisionSlider.value);
            const colorSensitivity = parseFloat(colorSensitivitySlider.value);
            
            // Fill image data
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const pixelIndex = (y * width + x) * 4;
                    const pixel = scene[y][x];
                    
                    // Human vision (original scene)
                    humanImageData.data[pixelIndex] = pixel[0] * 255;     // R
                    humanImageData.data[pixelIndex + 1] = pixel[1] * 255; // G
                    humanImageData.data[pixelIndex + 2] = pixel[2] * 255; // B
                    humanImageData.data[pixelIndex + 3] = 255;            // A
                    
                    // Gecko vision
                    // 1. Adjust color sensitivity (enhance blue-green, reduce red)
                    let geckoR = pixel[0] * 0.7;
                    let geckoG = pixel[1] * (1 + (colorSensitivity - 1) * 0.3); // Enhance green
                    let geckoB = pixel[2] * (1 + (colorSensitivity - 1) * 0.2); // Enhance blue
                    
                    // 2. Enhance night vision (brighten dark areas)
                    const luminance = 0.299 * geckoR + 0.587 * geckoG + 0.114 * geckoB;
                    if (luminance < 0.3) {
                        geckoR *= nightVisionStrength;
                        geckoG *= nightVisionStrength;
                        geckoB *= nightVisionStrength;
                    }
                    
                    // Ensure values are in valid range
                    geckoR = Math.min(1, geckoR);
                    geckoG = Math.min(1, geckoG);
                    geckoB = Math.min(1, geckoB);
                    
                    geckoImageData.data[pixelIndex] = geckoR * 255;     // R
                    geckoImageData.data[pixelIndex + 1] = geckoG * 255; // G
                    geckoImageData.data[pixelIndex + 2] = geckoB * 255; // B
                    geckoImageData.data[pixelIndex + 3] = 255;          // A
                }
            }
            
            // Put image data to canvases
            humanCtx.putImageData(humanImageData, 0, 0);
            geckoCtx.putImageData(geckoImageData, 0, 0);
            
            // Draw gecko pupil (vertical ellipse)
            geckoCtx.beginPath();
            geckoCtx.ellipse(width / 2, height / 2, width * 0.4, height * 0.15, 0, 0, 2 * Math.PI);
            geckoCtx.strokeStyle = 'white';
            geckoCtx.lineWidth = 2;
            geckoCtx.stroke();
        }
        
        // Event listeners
        generateButton.addEventListener('click', generateScene);
        
        nightVisionSlider.addEventListener('input', function() {
            nightVisionValue.textContent = this.value;
            renderScene();
        });
        
        colorSensitivitySlider.addEventListener('input', function() {
            colorSensitivityValue.textContent = this.value;
            renderScene();
        });
        
        // Initialize on load
        window.onload = function() {
            generateScene();
        };
    </script>
</body>
</html>
